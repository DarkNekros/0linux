Submitted By: Joe Ciccone
Date: 2007-05-29
Initial Package Version: 2.10.3
Upstream Status: None
Origin: Joe Ciccone
Description: Fixes multilib configuration issues where the config file has
             the path of libs in it. Usage:

sed -i "s/BUILDENV/32/" gtk/gtkrc.c \
                        modules/input/Makefile.am \
                        modules/input/Makefile.in

              Rediffed against 2.14.2 By Joe Ciccone on 2008-09-20
              Rediffed against 2.16.6 By Joe Ciccone on 2009-09-07
              Rediffed against 2.18.0 By Jim Gifford on 2009-09-22
              Rediffed against 2.23.2 By Jeremiah Dicharry on 2011-04-23


diff -Naur gtk+-2.23.2.orig/gtk/gtkrc.c gtk+-2.23.2/gtk/gtkrc.c
--- gtk+-2.23.2.orig/gtk/gtkrc.c	2010-11-10 04:34:43.000000000 -0800
+++ gtk+-2.23.2/gtk/gtkrc.c	2011-04-23 22:58:04.000000000 -0700
@@ -450,7 +450,7 @@
       if (im_module_file)
 	result = g_strdup (im_module_file);
       else
-	result = g_build_filename (GTK_SYSCONFDIR, "gtk-2.0", "gtk.immodules", NULL);
+	result = g_build_filename (GTK_SYSCONFDIR, "gtk-2.0-BUILDENV", "gtk.immodules", NULL);
     }
 
   return result;
diff -Naur gtk+-2.23.2.orig/modules/input/Makefile.am gtk+-2.23.2/modules/input/Makefile.am
--- gtk+-2.23.2.orig/modules/input/Makefile.am	2010-11-10 04:34:43.000000000 -0800
+++ gtk+-2.23.2/modules/input/Makefile.am	2011-04-23 23:00:48.000000000 -0700
@@ -187,10 +187,10 @@
 # after the libraries are installed in their final locations.
 install-data-hook:
 	@if $(RUN_QUERY_IMMODULES_TEST) ; then \
-	  echo $(mkinstalldirs) $(DESTDIR)$(sysconfdir)/gtk-2.0 ; \
-	  $(mkinstalldirs) $(DESTDIR)$(sysconfdir)/gtk-2.0 ; \
-	  echo "$(top_builddir)/gtk/gtk-query-immodules-2.0 > $(DESTDIR)$(sysconfdir)/gtk-2.0/gtk.immodules" ; \
-	  $(top_builddir)/gtk/gtk-query-immodules-2.0 > $(DESTDIR)$(sysconfdir)/gtk-2.0/gtk.immodules ; \
+	  echo $(mkinstalldirs) $(DESTDIR)$(sysconfdir)/gtk-2.0-BUILDENV ; \
+	  $(mkinstalldirs) $(DESTDIR)$(sysconfdir)/gtk-2.0-BUILDENV ; \
+	  echo "$(top_builddir)/gtk/gtk-query-immodules-2.0 > $(DESTDIR)$(sysconfdir)/gtk-2.0-BUILDENV/gtk.immodules" ; \
+	  $(top_builddir)/gtk/gtk-query-immodules-2.0 > $(DESTDIR)$(sysconfdir)/gtk-2.0-BUILDENV/gtk.immodules ; \
 	else \
 	  echo "***" ; \
 	  echo "*** Warning: gtk.immodules not built" ; \
@@ -201,7 +201,7 @@
         fi
 
 uninstall-local:
-	rm -f $(DESTDIR)$(sysconfdir)/gtk-2.0/gtk.immodules
+	rm -f $(DESTDIR)$(sysconfdir)/gtk-2.0-BUILDENV/gtk.immodules
 
 if BUILD_DYNAMIC_MODULES
 
diff -Naur gtk+-2.23.2.orig/modules/input/Makefile.in gtk+-2.23.2/modules/input/Makefile.in
--- gtk+-2.23.2.orig/modules/input/Makefile.in	2010-11-10 06:24:14.000000000 -0800
+++ gtk+-2.23.2/modules/input/Makefile.in	2011-04-23 23:01:55.000000000 -0700
@@ -1233,10 +1233,10 @@
 # after the libraries are installed in their final locations.
 install-data-hook:
 	@if $(RUN_QUERY_IMMODULES_TEST) ; then \
-	  echo $(mkinstalldirs) $(DESTDIR)$(sysconfdir)/gtk-2.0 ; \
-	  $(mkinstalldirs) $(DESTDIR)$(sysconfdir)/gtk-2.0 ; \
-	  echo "$(top_builddir)/gtk/gtk-query-immodules-2.0 > $(DESTDIR)$(sysconfdir)/gtk-2.0/gtk.immodules" ; \
-	  $(top_builddir)/gtk/gtk-query-immodules-2.0 > $(DESTDIR)$(sysconfdir)/gtk-2.0/gtk.immodules ; \
+	  echo $(mkinstalldirs) $(DESTDIR)$(sysconfdir)/gtk-2.0-BUILDENV ; \
+	  $(mkinstalldirs) $(DESTDIR)$(sysconfdir)/gtk-2.0-BUILDENV ; \
+	  echo "$(top_builddir)/gtk/gtk-query-immodules-2.0 > $(DESTDIR)$(sysconfdir)/gtk-2.0-BUILDENV/gtk.immodules" ; \
+	  $(top_builddir)/gtk/gtk-query-immodules-2.0 > $(DESTDIR)$(sysconfdir)/gtk-2.0-BUILDENV/gtk.immodules ; \
 	else \
 	  echo "***" ; \
 	  echo "*** Warning: gtk.immodules not built" ; \
@@ -1247,7 +1247,7 @@
         fi
 
 uninstall-local:
-	rm -f $(DESTDIR)$(sysconfdir)/gtk-2.0/gtk.immodules
+	rm -f $(DESTDIR)$(sysconfdir)/gtk-2.0-BUILDENV/gtk.immodules
 
 included-modules: $(noinst_LTLIBRARIES)
 
